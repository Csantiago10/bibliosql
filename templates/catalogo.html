<!-- Archivo: templates/catalogo.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Biblioteca Digital</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='estilos.css') }}">
    <!-- Agregamos FontAwesome para iconos bonitos (Opcional pero recomendado) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- BARRA DE NAVEGACI√ìN -->
    <nav class="navbar">
        <div class="logo"><a href="/">üìö BiblioSQL</a></div>
        <div class="toolbar">
            <!-- Formulario de B√∫squeda (Env√≠a datos por GET a la misma p√°gina) -->
            <form action="/catalogo" method="GET" class="search-form">
                <input type="text" name="q" placeholder="Buscar t√≠tulo, autor o editorial..." value="{{ busqueda }}">
                <button type="submit">Buscar</button>
                <!-- Si hay b√∫squeda, mostramos bot√≥n para limpiar -->
                {% if busqueda %}
                    <a href="/catalogo" class="btn-clear">‚ùå Limpiar</a>
                {% endif %}
            </form>
        </div>    
        <div class="nav-links">
            <a href="/catalogo">Cat√°logo</a>
            <a href="/registrar">Registrar</a>
        </div>
    </nav>

    <!-- ZONA DE MENSAJES FLASH -->
    <div style="max-width: 1200px; margin: 20px auto;">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alerta alerta-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <div class="contenedor_cuerpo">
        <h1>üìö Cat√°logo de Libros SQL</h1>
        <p>Si el stock del libro es menor a 5 la casilla se colorea de rojoüî¥.</p>

        <div class="contenedor_registro">
            <a href="/registrar" class="btn">‚ûï Registrar Nuevo Libro</a>
            <a href="/descargar_excel" class="btn">üì• Descargar Inventario en Excel</a>
        </div>

        <table>
            <thead>
                <tr>
                    <th>T√≠tulo</th>
                    <th>Categor√≠a</th>
                    <th>Autor</th>
                    <th>Editorial</th>
                    <th>P√°ginas</th>
                    <th>Stock</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <!-- AQU√ç COMIENZA LA MAGIA DE JINJA2 -->
                {% for libro in libros %}
                <tr>
                    <td>{{ libro.nombre }}</td>
                    <td>{{ libro.categoria }}</td>
                    <td>{{ libro.autor }}</td>
                    <td>{{ libro.editorial }}</td>
                    <td>{{ libro.paginas }}</td>
                    <!-- CELDA DE STOCK (AHORA CON EDICI√ìN R√ÅPIDA) -->
                    <td>
            
                        <!-- Creamos un mini formulario para cada fila -->
                        <form action="/actualizar_stock" method="POST" class="form-stock">
                
                            <!-- Truco de Ninja: Input oculto con el ID del libro -->
                            <input type="hidden" name="id_libro" value="{{ libro.id }}">
                
                            <!-- El n√∫mero editable -->
                            <input type="number" name="nuevo_stock" value="{{ libro.cantidad }}" min="0" class="input-stock {{ libro.clase_css_stock }}">

                            <!-- Bot√≥n de guardar (icono de disquete) -->
                            <button type="submit" class="btn-guardar" title="Actualizar Stock">üíæ</button>
                        </form>
                    </td>
                    <td class="eliminar">
                        <a href="/eliminar/{{ libro.id }}" class="btn-eliminar">
                            üóëÔ∏è Eliminar
                        </a>
                    </td>
                </tr>
                {% endfor %}
                <!-- FIN DEL BUCLE -->
            </tbody>
        </table>

        {% if total_pages > 1 %}
        <div class="pagination">
            <!-- Bot√≥n Anterior -->
            {% if page > 1 %}
                <a href="/catalogo?page={{ page-1 }}&q={{ busqueda }}" class="page-link">‚¨ÖÔ∏è Anterior</a>
            {% else %}
                <span class="page-link disabled">‚¨ÖÔ∏è Anterior</span>
            {% endif %}

            <span class="page-info">P√°gina {{ page }} de {{ total_pages }}</span>

            <!-- Bot√≥n Siguiente -->
            {% if page < total_pages %}
                <a href="/catalogo?page={{ page+1 }}&q={{ busqueda }}" class="page-link">Siguiente ‚û°Ô∏è</a>
            {% else %}
                <span class="page-link disabled">Siguiente ‚û°Ô∏è</span>
            {% endif %}
        </div>
        {% endif %}
        <br>
        <a href="/" class="btn">Volver al inicio</a>
    </div>
    

    <!-- FOOTER -->
    <footer>
        <p>Desarrollado con Python Flask &copy; 2026 - Ingeniero Santiago Nore√±a</p>
    </footer>

    <script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>